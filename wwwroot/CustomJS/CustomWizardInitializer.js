
let employeeCode = $('.EmployeeCode').val();

let initMethods = {

    initializeWizard: function () {
        swal({
            title: 'To proceed with employee take-on, enter employee code below',
            buttonsStyling: false,
            html: `<select class="form-control" onchange="initMethods.getEmployeeNumberType($(this).val())"  data-live-search="true">
                        <option value="" selected disabled>Select employee number type </option>
                        <option value="OwnNumber">Own Number </option>
                        <option value="AutoGenerated">Auto Generated </option>
                         </select><br>
                    <input type ='text' class='form-control EmployeeCode' placeholder="Enter employee number" style='text-transform:uppercase; display: none'>`,
            confirmButtonClass: 'btn btn-success confirmButton',
            confirmButtonText: 'Proceed',
            allowOutsideClick: false,
            cancelButtonClass: 'btn btn-danger cancelButton',
            showCancelButton: true,
        });

        $('.cancelButton').click(function () {
            window.location.href = '/Employee/Index';
        });

        $('.confirmButton').on('click', function () {
            if (employeeCode === '') {
                window.location.href = '/Employee/Index';
            } else {
                $('#employeeCode').val(employeeCode);
                $.post('/Employee/CheckEmployeeExistence', {employeeCode: employeeCode})
                    .done(function (data) {
                        initMethods.checkEmployeeCode(data);
                    })
                    .fail(function (error) {
                        console.log(error);
                    });
            }
        });
    },
    
    checkEmployeeCode: function (response) {
        let txt;
        let cssProperty = "";
        let msg;
        let btnText;
        let buttonText;
        if (response === false) {
            txt = 'success';
            cssProperty = $('.card-wizard').css('display', 'block');
            msg = 'Click on Proceed Button to continue..';
            btnText = 'btn btn-success';
            buttonText = 'Proceed';

            swal({
                type: txt,
                html: msg,
                confirmButtonClass: btnText,
                confirmButtonText: buttonText,
                allowOutsideClick: false
            }).then(function (result) {
                cssProperty;
            }).catch(swal.noop)
        } else {
            cssProperty = $('.card-wizard').css('display', 'none');
            txt = 'error';
            msg = 'This employee code already exists!';
            btnText = 'btn btn-danger';
            buttonText = 'Ok';

            swal({
                type: txt,
                html: msg,
                confirmButtonClass: btnText,
                confirmButtonText: buttonText,
                allowOutsideClick: false
            }).then(function (result) {
                initMethods.initializeWizard();
            }).catch(swal.noop)
        }
    },

    getEmployeeNumberType: function ($this) {

        if ($this === 'OwnNumber') {
            $('.EmployeeCode').css('display', 'block');
        } else {
            $('.EmployeeCode').css('display', 'none');
            initMethods.checkEmployeeCode(false);
        }
    }
}

$(document).ready(function () {
    initMethods.initializeWizard();
})
